CanDataSender

○ インストール手順

  $ adb install CanDataSender.apk


○ 使用方法

(1) サーバに接続する
    メイン画面から「サーバ接続」をタップする。
    「接続先の追加」をタップして、情報を入力する。
    追加した接続名が表示されるので、それをタップする。
    「接続」をタップする。

    | 正常に接続されると、接続名の前に "接続中" と表記される。
    | 切断するには「接続の終了」をタップする。
    | 設定情報は端末内に保存され、次回からは入力不要である。
    | メイン画面に戻るにはBACKボタンをタップする。

(2) データの登録先テーブルを選択する
    メイン画面から「データ登録先テーブル」をタップする。
    サーバにあるテーブル一覧が表示されるので、登録したいテーブル名を
    タップする。

    | この操作を行う前に、サーバに接続しておくこと。
    | このアプリケーションからテーブルを作成・削除することはできない。
    | テーブルには、必要なカラムがあること。

(3) RAWデータの送信先ディレクトリを設定する
    メイン画面から「RAWデータ送信先ディレクトリ」をタップする。
    RAWデータを保存するサーバのディレクトリを入力する。

(4) データを送信する
    データの送信方法は(4.1)～(4.3)の３種類ある。

(4.1) 今から取得するデータを自動でテーブルに登録する
      ※未サポート
      | サービスを立ち上げて、この後に起動されるCANデータ取得アプリと
      | 連携してテーブルにデータをリアルタイムで送信予定。

(4.2) 取得済みデータをテーブルに登録する
      既に取得した端末内にあるデータをテーブルに登録する。
      メイン画面から「既存データ登録」をタップする。
      端末内に保存されているデータのリストが表示されるので、
      登録したいデータをタップして、送信する。

      | CSVファイルを解析、サーバにデータを送信、テーブルに登録する。
      | 画像データは、「RAWデータ送信先ディレクトリ」に保存される。

(4.3) 取得済みRAWデータをサーバに送信する
      既に取得した端末内にあるRAWデータをサーバに送信する。
      メイン画面から「既存RAWデータ送信」をタップする。
      端末内に保存されているデータのリストが表示されるので、
      登録したいデータをタップして、送信する。

      | CSVファイル、画像ファイルなどディレクトリ内のファイルを
      | サーバに送信する。

(5) 終了する
    メイン画面から「終了」をタップする。
    サーバへの接続が切断される。


○ 対応するデータ形式

対応しているデータ及び想定しているデータファイルは以下の通り。

(a) CarLink (USB)
    データが保存されるパス：<外部ストレージ>/carlink_can_usb_accessory/log

    CANデータ：		cl_can_*.csv
    加速度データ：	cl_acc_*.csv
    姿勢データ：	cl_pose_*.csv
    位置データ：	cl_loc_*.csv
    映像と音声データ：	cl_video_*.csv

(b) CarLink (BT)
    データが保存されるパス：<外部ストレージ>/carlink_can_bt/log

    CANデータ：		cl_can_*.csv
    加速度データ：	cl_acc_*.csv
    姿勢データ：	cl_pose_*.csv
    位置データ：	cl_loc_*.csv
    映像と音声データ：	cl_video_*.csv

(c) CanGather
    データが保存されるパス：<外部ストレージ>/ECS/CanGather/log

    CANデータ：		itsecu_*.csv
    センサデータ：	sensor_*.csv
    GPSデータ：		gps_*.csv
    環境データ：	env_*.csv
    画像データ：	*.jpg


○  CanDataSender用テーブルの生成方法

"CanDataSender-table.sql"ファイルをサーバにコピーして、カレントディレクトリを
ファイルをコピーしたディレクトリに変更して、以下のコマンドを実行する。
(注意1)
"candata"テーブルが存在すると、上書きされる。以前の"candata"テーブル情報は全て
削除されるので、注意すること。
(注意2)
ユーザ名やパスワードはPostgreSQLのユーザ名とパスワードである。


$ PGPASSWORD=<パスワード> psql <データベース名> <ユーザ名> -f CanDataSender-table.sql

以上
